# prompt_definitions.py
# -*- coding: utf-8 -*-
"""
集中存放所有提示词 (Prompt)，整合雪花写作法、角色弧光理论、悬念三要素模型等
并包含新增加的前三章摘要/下一章关键字提炼提示词，以及章节正文写作提示词。
"""

# =============== 生成草稿提示词当前章节摘要、知识库提炼 ===============
# 当前章节摘要生成提示词
summarize_recent_chapters_prompt = """\
作为一名专业的小说编辑和知识管理专家，正在基于已完成的前三章内容和本章信息生成当前章节的精准摘要。请严格遵循以下工作流程：
前三章内容：
{combined_text}

当前章节信息：
第{novel_number}章《{chapter_title}》：
├── 本章定位：{chapter_role}
├── 核心作用：{chapter_purpose}
├── 悬念密度：{suspense_level}
├── 伏笔操作：{foreshadowing}
├── 认知颠覆：{plot_twist_level}
└── 本章简述：{chapter_summary}

下一章信息：
第{next_chapter_number}章《{next_chapter_title}》：
├── 本章定位：{next_chapter_role}
├── 核心作用：{next_chapter_purpose}
├── 悬念密度：{next_chapter_suspense_level}
├── 伏笔操作：{next_chapter_foreshadowing}
├── 认知颠覆：{next_chapter_plot_twist_level}
└── 本章简述：{next_chapter_summary}

**上下文分析阶段**：
1. 回顾前三章核心内容：
   - 第一章核心要素：[章节标题]→[核心冲突/理论]→[关键人物/概念]
   - 第二章发展路径：[已建立的人物关系]→[技术/情节进展]→[遗留伏笔]
   - 第三章转折点：[新出现的变量]→[世界观扩展]→[待解决问题]
2. 提取延续性要素：
   - 必继承要素：列出前3章中必须延续的3个核心设定
   - 可调整要素：识别2个允许适度变化的辅助设定

**当前章节摘要生成规则**：
1. 内容架构：
   - 继承权重：70%内容需与前3章形成逻辑递进
   - 创新空间：30%内容可引入新要素，但需标注创新类型（如：技术突破/人物黑化）
2. 结构控制：
   - 采用"承继→发展→铺垫"三段式结构
   - 每段含1个前文呼应点+1个新进展
3. 预警机制：
   - 若检测到与前3章设定冲突，用[!]标记并说明
   - 对开放式发展路径，提供2种合理演化方向

现在请你基于目前故事的进展，完成以下两件事：
用最多800字，写一个简洁明了的「当前章节摘要」；

请按如下格式输出（不需要额外解释）：
当前章节摘要: <这里写当前章节摘要>
"""

# 知识库相关性检索提示词
knowledge_search_prompt = """\
请基于以下当前写作需求，生成合适的知识库检索关键词：

章节元数据：
- 准备创作：第{chapter_number}章
- 章节主题：{chapter_title}
- 核心人物：{characters_involved}
- 关键道具：{key_items}
- 场景位置：{scene_location}

写作目标：
- 本章定位：{chapter_role}
- 核心作用：{chapter_purpose}
- 伏笔操作：{foreshadowing}

当前摘要：
{short_summary}

- 用户指导：
{user_guidance}

- 核心人物(可能未指定)：{characters_involved}
- 关键道具(可能未指定)：{key_items}
- 空间坐标(可能未指定)：{scene_location}
- 时间压力(可能未指定)：{time_constraint}

生成规则：

1.关键词组合逻辑：
-类型1：[实体]+[属性]（如"量子计算机 故障日志"）
-类型2：[事件]+[后果]（如"实验室爆炸 辐射泄漏"）
-类型3：[地点]+[特征]（如"地下城 氧气循环系统"）

2.优先级：
-首选用户指导中明确提及的术语
-次选当前章节涉及的核心道具/地点
-最后补充可能关联的扩展概念

3.过滤机制：
-排除抽象程度高于"中级"的概念
-排除与前3章重复率超60%的词汇

请生成3-5组检索词，按优先级降序排列。
格式：每组用"·"连接2-3个关键词，每组占一行

示例：
科技公司·数据泄露
地下实验室·基因编辑·禁忌实验
"""

# 知识库内容过滤提示词
knowledge_filter_prompt = """\
对知识库内容进行三级过滤：

待过滤内容：
{retrieved_texts}

当前叙事需求：
{chapter_info}

过滤流程：

冲突检测：

删除与已有摘要重复度＞40%的内容

标记存在世界观矛盾的内容（使用▲前缀）

价值评估：

关键价值点（❗标记）：
· 提供新的角色关系可能性
· 包含可转化的隐喻素材
· 存在至少2个可延伸的细节锚点

次级价值点（·标记）：
· 补充环境细节
· 提供技术/流程描述

结构重组：

按"情节燃料/人物维度/世界碎片/叙事技法"分类

为每个分类添加适用场景提示（如"可用于XX类型伏笔"）

输出格式：
[分类名称]→[适用场景]
❗/· [内容片段] （▲冲突提示）
...

示例：
[情节燃料]→可用于时间压力类悬念
❗ 地下氧气系统剩余23%储量（可制造生存危机）
▲ 与第三章提到的"永久生态循环系统"存在设定冲突

仅给出最终文本，不要解释任何内容。
提示词：内容
"""

# =============== 1. 核心种子设定（无限流专属）===================
# 专为无限流小说设计：主神空间+多世界穿越+任务奖励
core_seed_prompt = """\
作为专业网文作家，请为无限流小说构建故事核心：
主题：{topic}
类型：无限流/诸天流/轮回空间
篇幅：约{number_of_chapters}章（每章{word_number}字）

请用公式化结构概括故事本质（无限流核心公式）：
"[普通人] + 意外进入[主神空间/主神账号/系统] → 穿越[电影/动漫/游戏/小说世界]做任务 → 获取[积分/道具/能力] → 不断变强 → 最终目标[成为主神/超脱轮回/回归现实/挑战更高层面]"

示例：
"普通大学生意外被拉入[主神空间]，获得[轮回者身份]，每十天必须穿越到一部动漫/电影世界中完成主线任务。完成任务获得积分和道具，失败则抹杀。在《生化危机》世界获得T病毒血清，在《斗罗大陆》获得魂环，在《漫威》获得无限宝石...逐步收集诸天万界的力量，最终成为超越主神的存在。"

要求（无限流专属）：
1. 主神空间设定：必须明确主神空间的规则（任务模式/奖励机制/淘汰机制）
2. 世界穿越：明确主角会穿越哪些类型的世界（动漫/电影/游戏/小说）
3. 核心爽点：诸天万界收集（技能/道具/血脉/美人）、打脸各世界土著、队友配合
4. 目标驱动：积分/道具/能力收集、变强、最终超脱
5. 压力来源：任务失败抹杀、轮回者竞争、隐藏敌人

仅返回故事核心文本，不要解释任何内容。
"""

# =============== 2. 角色动力学设定（无限流专属）===================
# 专为无限流小说设计：轮回者+各世界土著+队友+主神空间势力
character_dynamics_prompt = """\
基于以下元素：
- 内容指导：{user_guidance}
- 核心种子：{core_seed}

请设计无限流的核心角色体系（3-8人）：

【主角设计 - 必须包含以下要素】
1. 现实身份：穿越前的身份（如普通大学生/程序员/社畜/特种兵）
2. 轮回者身份：进入主神空间后的编号/代号
3. 金手指：轮回者的特殊能力/系统/天赋（如能看到剧情/属性强化/储物空间）
4. 核心目标：收集诸天能力/挑战主神/回归现实/超脱轮回
5. 性格标签：1-2个鲜明特点（如腹黑/稳健/杀伐果断/老阴比/护短）

【配角功能划分 - 无限流专属类型】

1. 轮回者队友（长期）：
   - 身份：主神空间内的队友
   - 作用：并肩作战、提供辅助、情感羁绊
   - 特点：一起做任务、可以培养默契

2. 各世界土著角色（每个世界可能出现）：
   - 身份：动漫/电影/小说世界的原住民
   - 作用：提供任务线索、成为后宫/伙伴、反派
   - 特点：每个世界有不同角色，主角可以带走或留下

3. 轮回者竞争对手/敌人：
   - 身份：其他轮回者团队或个人
   - 作用：抢任务/抢奖励/背后阴人
   - 下场：要么被主角杀掉，要么结仇

4. 主神空间势力（隐藏Boss）：
   - 身份：主神空间的创造者/管理者/更高层次的存在
   - 作用：最终Boss/最大悬念
   - 特点：前期不出现，中后期逐步揭露

【关系网设计】
- 主角与队友：信任/依靠/并肩作战
- 主角与竞争对手：竞争/仇恨/生死对决
- 主角与各世界土著：攻略/收服/利用/错过
- 队友之间：可能有内部矛盾

要求（无限流专属）：
- 主角必须“利己但不圣母”，有仇必报
- 队友可以死（增加悲壮感），但核心队友要有羁绊
- 每个世界结束后可以带回1-2个角色
- 主角实力通过“技能/道具/血脉”收集来提升

仅给出最终文本，不要解释任何内容。
"""

# =============== 3. 世界构建矩阵（无限流专属）===================
# 专为无限流小说设计：主神空间+诸天世界+任务体系
world_building_prompt = """\
基于以下元素：
- 内容指导：{user_guidance}
- 核心冲突："{core_seed}"

请构建无限流的世界观（必须包含以下核心要素）：

【主神空间设定 - 必须明确】
1. 主神空间基本规则：
   - 轮回者进入方式（意外/被选中/自愿）
   - 主神空间的本质（高等文明/系统/更高位面存在）
   - 主神的目的是什么（筛选/娱乐/进化实验）

2. 任务模式：
   - 穿越间隔（每次任务间隔时间）
   - 任务类型（主线/支线/隐藏/阵营任务）
   - 任务难度划分（D/C/B/A/S/SS级）
   - 任务失败惩罚（抹杀/扣除积分/属性削弱）

3. 奖励机制：
   - 积分/点数的用途（强化/兑换/复活）
   - 道具/技能兑换列表
   - 权限升级（轮回者→小队长→队长等）

【诸天世界体系 - 无限流核心】
列出主角会穿越的世界（至少6-10个，分层次）：
1. 初级世界（熟悉剧情，风险低）：
   - 例：生化危机/庆余年/鹿鼎记/射雕英雄传
   
2. 中级世界（开始有难度）：
   - 例：斗破苍穹/天龙八部/倚天屠龙记/漫威电影
   
3. 高级世界（高风险高回报）：
   - 例：完美世界/遮天/洪荒/哈利波特
   
4. 顶级世界（最终挑战）：
   - 例：完美世界/超神学院/三体/龙珠

【能力收集体系 - 无限流专属】
1. 可收集的能力类型：
   - 技能（魔法/忍术/斗气/血脉）
   - 道具（武器/宝具/血脉/血统）
   - 召唤兽/宠物
   - 团队/势力
   
2. 能力强化方式：
   - 主神空间强化（消耗积分）
   - 融合其他世界的能力
   - 血脉/血统进化

【轮回者势力】
1. 轮回者团队（主角所在团队）
2. 其他轮回者团队（竞争/敌对）
3. 主神空间的隐藏势力

要求（无限流专属）：
- 每个世界必须有独特的任务和收获
- 主角可以带回上个世界的能力/道具
- 世界之间要有层次感，从低到高
- 主神空间是永恒的主线悬念

仅给出最终文本，不要解释任何内容。
"""

# =============== 4. 情节架构（无限流专属）===================
# 专为无限流小说设计：穿越世界+任务+收集+回归
plot_architecture_prompt = """\
基于以下元素：
- 内容指导：{user_guidance}
- 核心种子：{core_seed}
- 角色体系：{character_dynamics}
- 世界观：{world_building}

请设计无限流小说的情节架构（核心是"世界穿越单元"）：

【世界穿越单元 - 无限流核心结构】
每个世界（8-15章）必须包含：
1. 穿越与设定（1-2章）：
   - 主神空间的任务提示
   - 了解该世界的基本剧情
   - 制定行动计划

2. 任务执行与打脸（4-8章）：
   - 完成主线/支线任务
   - 与该世界土著互动（攻略/结仇）
   - 轮回者之间的竞争/合作
   - 打脸土著天才/反派
   - 收获能力/道具/积分

3. 收获与回归（1-2章）：
   - 结算任务奖励
   - 带回可携带的能力/道具/角色
   - 实力提升
   - 留下下一个世界的钩子

【整体节奏设计】
- 第1个世界：新手试炼世界，低难度，建立轮回者身份
- 第2-3个世界：初级世界，开始积累优势和队友
- 第4-6个世界：中级世界，遭遇其他轮回者竞争
- 第7-10个世界：高级世界，势力逐渐强大
- 第10个世界后：顶级世界，挑战主神空间真相

【无限流爽点类型 - 必须交替出现】
1. 剧情先知（利用剧情信息差搞事情）
2. 打脸土著天才（你们世界的天才不如我）
3. 能力收集（各种世界的能力融合变强）
4. 队友配合（团队协作完成任务）
5. 越级挑战（低轮回者挑战高难度世界）
6. 截胡其他轮回者（抢奖励/抢机缘）
7. 带回强力角色（土著成为队友/后宫）

【核心原则 - 绝对禁止】
- ❌ 主角憋屈超过3章不反击
- ❌ 任务失败惩罚过于频繁（读者会弃坑）
- ❌ 核心队友频繁死亡（要有感情线）
- ❌ 纯给其他垫轮回者当脚石

要求：
- 每个世界必须有完整的故事线
- 每3个世界至少安排一次大收获（强力能力/道具）
- 留下主神空间真相的悬念钩子

仅给出最终文本，不要解释任何内容。
"""

# =============== 5. 章节目录生成（无限流专属）===================
# 专为无限流小说设计：世界穿越单元+任务节点+断章钩子
chapter_blueprint_prompt = """\
基于以下元素：
- 内容指导：{user_guidance}
- 小说架构：
{novel_architecture}

请设计{number_of_chapters}章的节奏分布（无限流专属）：

【章节集群划分 - 以世界为单位】
- 每个世界需要8-15章来完整展现
- 章节阶段：穿越降临(1-2章) → 任务执行/打脸(4-8章) → 收获回归(1-2章)
- 世界之间可以有1-2章主神空间过渡

【每章必须明确 - 无限流特色】
- 章节定位：属于哪个世界的哪个阶段
- 穿越世界名：本章发生在哪个世界（如《生化危机》《斗破苍穹》）
- 核心爽点类型：本章核心爽点（剧情先知/打脸土著/能力收集/队友配合等）
- 断章钩子：本章结尾的钩子设计（必须！）

【断章技巧 - 必须掌握】
网文断章的核心是"在最爽/最关键的时刻切断，让读者忍不住看下一章"

断章类型（无限流专属）：
1. 任务危机型：轮回者即将失败/被围攻，戛然而止
2. 震惊揭示型：刚发现隐藏任务/稀有道具，切断
3. 冲突爆发型：遭遇其他轮回者/土著强者，一触即发
4. 收获中断型：刚获得强力能力/道具，被主神召回
5. 世界切换型：刚打完Boss，主神空间结算...下个世界是？

【输出格式示例】
第n章 - [标题]
穿越世界：[世界名称]
本章定位：[穿越降临/任务执行/打脸收获/主神空间]
核心爽点：[本章节的核心爽点类型]
断章钩子：[本章结尾的钩子设计]
本章简述：[一句话概括本章内容]

第n+1章 - [标题]
穿越世界：[世界名称]
本章定位：[穿越降临/任务执行/打脸收获/主神空间]
核心爽点：[本章节的核心爽点类型]
断章钩子：[本章结尾的钩子设计]
本章简述：[一句话概括本章内容]

要求：
- 每章字数控制在80字以内，精炼表达
- 断章钩子必须具体，不能写"未完待续"
- 每3章至少安排一次小爽点（打脸/收获）
- 每个世界结尾必须留钩子（主神空间/下个世界预告）

仅给出最终文本，不要解释任何内容。
"""

chunked_chapter_blueprint_prompt = """\
基于以下元素：
- 内容指导：{user_guidance}
- 小说架构：
{novel_architecture}

需要生成总共{number_of_chapters}章的节奏分布，

当前已有章节目录（若为空则说明是初始生成）：\n
{chapter_list}

现在请设计第{n}章到第{m}的节奏分布（无限流专属）：

【章节集群划分 - 以世界为单位】
- 每个世界需要8-15章来完整展现
- 章节阶段：穿越降临(1-2章) → 任务执行/打脸(4-8章) → 收获回归(1-2章)
- 世界之间可以有1-2章主神空间过渡

【每章必须明确 - 无限流特色】
- 章节定位：属于哪个世界的哪个阶段
- 穿越世界名：本章发生在哪个世界（如《生化危机》《斗破苍穹》）
- 核心爽点类型：本章核心爽点（剧情先知/打脸土著/能力收集/队友配合等）
- 断章钩子：本章结尾的钩子设计（必须！）

【断章技巧 - 必须掌握】
网文断章的核心是"在最爽/最关键的时刻切断，让读者忍不住看下一章"

断章类型（无限流专属）：
1. 任务危机型：轮回者即将失败/被围攻，戛然而止
2. 震惊揭示型：刚发现隐藏任务/稀有道具，切断
3. 冲突爆发型：遭遇其他轮回者/土著强者，一触即发
4. 收获中断型：刚获得强力能力/道具，被主神召回
5. 世界切换型：刚打完Boss，主神空间结算...下个世界是？

输出格式示例：
第n章 - [标题]
穿越世界：[世界名称]
本章定位：[穿越降临/任务执行/打脸收获/主神空间]
核心爽点：[本章节的核心爽点类型]
断章钩子：[本章结尾的钩子设计]
本章简述：[一句话概括本章内容]

第n+1章 - [标题]
穿越世界：[世界名称]
本章定位：[穿越降临/任务执行/打脸收获/主神空间]
核心爽点：[本章节的核心爽点类型]
断章钩子：[本章结尾的钩子设计]
本章简述：[一句话概括本章内容]

要求：
- 每章字数控制在80字以内，精炼表达
- 断章钩子必须具体，不能写"未完待续"
- 每3章至少安排一次小爽点（打脸/收获）
- 每个世界结尾必须留钩子（主神空间/下个世界预告）

仅给出最终文本，不要解释任何内容。
"""

# =============== 6. 前文摘要更新 ===================
summary_prompt = """\
以下是新完成的章节文本：
{chapter_text}

这是当前的前文摘要（可为空）：
{global_summary}

请根据本章新增内容，更新前文摘要。
要求：
- 保留既有重要信息，同时融入新剧情要点
- 以简洁、连贯的语言描述全书进展
- 客观描绘，不展开联想或解释
- 总字数控制在2000字以内

仅返回前文摘要文本，不要解释任何内容。
"""

# =============== 7. 角色状态更新 ===================
create_character_state_prompt = """\
依据当前角色动力学设定：{character_dynamics}

请生成一个角色状态文档，内容格式：
例：
张三：
├──物品:
│  ├──青衫：一件破损的青色长袍，带有暗红色的污渍
│  └──寒铁长剑：一柄断裂的铁剑，剑身上刻有古老的符文
├──能力
│  ├──技能1：强大的精神感知能力：能够察觉到周围人的心中活动
│  └──技能2：无形攻击：能够释放一种无法被视觉捕捉的精神攻击
├──状态
│  ├──身体状态: 身材挺拔，穿着华丽的铠甲，面色冷峻
│  └──心理状态: 目前的心态比较平静，但内心隐藏着对柳溪镇未来掌控的野心和不安
├──主要角色间关系网
│  ├──李四：张三从小就与她有关联，对她的成长一直保持关注
│  └──王二：两人之间有着复杂的过去，最近因一场冲突而让对方感到威胁
├──触发或加深的事件
│  ├──村庄内突然出现不明符号：这个不明符号似乎在暗示柳溪镇即将发生重大事件
│  └──李四被刺穿皮肤：这次事件让两人意识到对方的强大实力，促使他们迅速离开队伍

角色名：
├──物品:
│  ├──某物(道具)：描述
│  └──XX长剑(武器)：描述
│   ...
├──能力
│  ├──技能1：描述
│  └──技能2：描述
│   ...
├──状态
│  ├──身体状态：
│  └──心理状态：描述
│    
├──主要角色间关系网
│  ├──李四：描述
│  └──王二：描述
│   ...
├──触发或加深的事件
│  ├──事件1：描述
│  └──事件2：描述
    ...

新出场角色：
- (此处填写未来任何新增角色或临时出场人物的基本信息)

要求：
仅返回编写好的角色状态文本，不要解释任何内容。
"""

update_character_state_prompt = """\
以下是新完成的章节文本：
{chapter_text}

这是当前的角色状态文档：
{old_state}

请更新主要角色状态，内容格式：
例：
张三：
├──物品:
│  ├──青衫：一件破损的青色长袍，带有暗红色的污渍
│  └──寒铁长剑：一柄断裂的铁剑，剑身上刻有古老的符文
├──能力
│  ├──技能1：强大的精神感知能力：能够察觉到周围人的心中活动
│  └──技能2：无形攻击：能够释放一种无法被视觉捕捉的精神攻击
├──状态
│  ├──身体状态: 身材挺拔，穿着华丽的铠甲，面色冷峻
│  └──心理状态: 目前的心态比较平静，但内心隐藏着对柳溪镇未来掌控的野心和不安
├──主要角色间关系网
│  ├──李四：张三从小就与她有关联，对她的成长一直保持关注
│  └──王二：两人之间有着复杂的过去，最近因一场冲突而让对方感到威胁
├──触发或加深的事件
│  ├──村庄内突然出现不明符号：这个不明符号似乎在暗示柳溪镇即将发生重大事件
│  └──李四被刺穿皮肤：这次事件让两人意识到对方的强大实力，促使他们迅速离开队伍

角色名：
├──物品:
│  ├──某物(道具)：描述
│  └──XX长剑(武器)：描述
│   ...
├──能力
│  ├──技能1：描述
│  └──技能2：描述
│   ...
├──状态
│  ├──身体状态：
│  └──心理状态：描述
│    
├──主要角色间关系网
│  ├──李四：描述
│  └──王二：描述
│   ...
├──触发或加深的事件
│  ├──事件1：描述
│  └──事件2：描述
    ...

......

新出场角色：
- 任何新增角色或临时出场人物的基本信息，简要描述即可，不要展开，淡出视线的角色可删除。

要求：
- 请直接在已有文档基础上进行增删
- 不改变原有结构，语言尽量简洁、有条理

仅返回更新后的角色状态文本，不要解释任何内容。
"""

# =============== 8. 章节正文写作（无限流专属）===================
# 专为无限流小说设计：剧情先知+土著震惊+能力收集+主神空间

# 8.1 第一章草稿提示（无限流开篇）
first_chapter_draft_prompt = """\
即将创作：第 {novel_number} 章《{chapter_title}》
本章定位：{chapter_role}
核心作用：{chapter_purpose}
本章简述：{chapter_summary}
穿越世界（如适用）：{scene_location}
爽点类型：本章核心爽点（剧情先知/打脸土著/能力收集/队友配合）
断章钩子：本章结尾的钩子设计

可用元素：
- 核心人物(可能未指定)：{characters_involved}
- 关键道具(可能未指定)：{key_items}
- 空间坐标(可能未指定)：{scene_location}
- 时间压力(可能未指定)：{time_constraint}

参考文档：
- 小说设定：
{novel_setting}

完成第 {novel_number} 章的正文，字数要求{word_number}字，
无限流专属写作技巧（必须运用）：

【剧情先知 - 无限流核心爽点】
- 主角知道该世界剧情走向，利用信息差搞事情
- 提前知道Boss弱点/宝藏位置/剧情走向
- 可以提前截胡土著强者的机缘

【土著震惊 - 打脸各世界天才】
- 土著天才嘲讽主角 → 主角展现实力 → 土著震惊
- 围观群众震惊："他怎么可能知道..."
- 用该世界土著的标志性震惊反应

【能力收集 - 收获诸天能力】
- 完成任务后获得积分/道具/技能
- 可以融合多个世界的能力
- 每章至少获得一点有用的东西

【轮回者互动】
- 与队友配合完成任务
- 与其他轮回者竞争/交锋
- 展现团队默契或勾心斗角

【主神空间元素】
- 任务提示/主神冰冷的提示音
- 轮回者面板/属性/兑换
- 主神空间的规则暗示

格式要求：
- 仅返回章节正文文本；
- 不使用分章节小标题；
- 不要使用markdown格式。

额外指导(可能未指定)：{user_guidance}
"""

# 8.2 后续章节草稿提示（无限流专属）
next_chapter_draft_prompt = """\
参考文档：
└── 前文摘要：
    {global_summary}

└── 前章结尾段：
    {previous_chapter_excerpt}

└── 用户指导：
    {user_guidance}

└── 角色状态：
    {character_state}

└── 当前章节摘要：
    {short_summary}

当前章节信息：
第{novel_number}章《{chapter_title}》：
├── 章节定位：{chapter_role}
├── 核心作用：{chapter_purpose}
├── 章节简述：{chapter_summary}
├── 字数要求：{word_number}字
├── 穿越世界（如适用）：{scene_location}
├── 核心人物：{characters_involved}
├── 关键道具：{key_items}
└── 时间压力：{time_constraint}

下一章节目录
第{next_chapter_number}章《{next_chapter_title}》：
├── 章节定位：{next_chapter_role}
├── 章节简述：{next_chapter_summary}

⚠️ 重要约束（必须严格遵守）：
1. 禁止在本章中提前呈现下一章的内容、转折或结局
2. 本章的结尾应该停留在当前章节的叙事节点上，为下一章留下悬念空间
3. 不要在本章中直接解决下一章预告的问题或冲突
4. 如果是主神空间章节，不要提前透露下个世界是什么

知识库参考：（按优先级应用）
{filtered_context}

🎯 知识库应用规则（无限流专属）：
1. 内容分级：
   - 世界观资料类（优先）：
     ▸ 该世界的剧情走向/人物关系
     ▸ 原著/电影动漫的经典/情节
     ▸ 土著名场面/经典台词
   - 能力资料类：
     ▸ 该世界的力量体系
     ▸ 可获取的道具/技能
   - 禁忌项类（必须规避）：
     ▸ 已在前文出现过的特定情节
     ▸ 拖沓的心理描写（网文大忌）

2. 使用限制：
   ● 禁止直接复制原著情节
   ● 历史章节内容仅允许：
     → 参照节奏模式（不超过20%相似度）
     → 延续必要的能力展示（需改编30%以上）
   ● 第三方写作知识优先用于：
     → 增强剧情先知效果（占知识应用的60%以上）
     → 创新土著震惊场面（至少1处新技巧）

依据前面所有设定，开始完成第 {novel_number} 章的正文，字数要求{word_number}字，
无限流专属写作技巧（必须运用）：

【剧情先知 - 无限流核心爽点】
- 主角知道该世界剧情走向，利用信息差搞事情
- 提前知道Boss弱点/宝藏位置/剧情走向
- 可以提前截胡土著强者的机缘
- 利用"我知道剧情"的优越感制造爽点

【土著震惊 - 打脸各世界天才】
- 土著天才嘲讽主角 → 主角展现实力 → 土著震惊
- 围观群众震惊："他怎么可能知道..."
- 用该世界土著的标志性震惊反应

【能力收集 - 收获诸天能力】
- 完成任务后获得积分/道具/技能
- 可以融合多个世界的能力
- 每章至少获得一点有用的东西
- 展现能力组合技

【轮回者互动】
- 与队友配合完成任务
- 与其他轮回者竞争/交锋
- 展现团队默契或勾心斗角

【主神空间元素】
- 主神冰冷的提示音/任务结算
- 轮回者面板/属性/兑换
- 主神空间的规则暗示

【断章技巧 - 本章结尾必须】
- 在最爽/最关键的时刻切断
- 断章类型（无限流专属）：
  - 任务危机型：轮回者即将失败/被围攻，戛然而止
  - 震惊揭示型：刚发现隐藏任务/稀有道具，切断
  - 冲突爆发型：遭遇其他轮回者/土著强者，一触即发
  - 收获中断型：刚获得强力能力/道具，被主神召回
  - 世界切换型：刚打完Boss，主神空间结算...下个世界是？

内容生成严格遵循：
- 用户指导
- 当前章节摘要
- 当前章节信息
- 无逻辑漏洞
- 确保章节内容与前文摘要、前章结尾段衔接流畅

格式要求：
- 仅返回章节正文文本；
- 不使用分章节小标题；
- 不要使用markdown格式。
"""

Character_Import_Prompt = """\
根据以下文本内容，分析出所有角色及其属性信息，严格按照以下格式要求：

<<角色状态格式要求>>
1. 必须包含以下五个分类（按顺序）：
   ● 物品 ● 能力 ● 状态 ● 主要角色间关系网 ● 触发或加深的事件
2. 每个属性条目必须用【名称: 描述】格式
   例：├──青衫: 一件破损的青色长袍，带有暗红色的污渍
3. 状态必须包含：
   ● 身体状态: [当前身体状况]
   ● 心理状态: [当前心理状况]
4. 关系网格式：
   ● [角色名称]: [关系类型，如"竞争对手"/"盟友"]
5. 触发事件格式：
   ● [事件名称]: [简要描述及影响]

<<示例>>
李员外:
├──物品:
│  ├──青衫: 一件破损的青色长袍，带有暗红色污渍
│  └──寒铁长剑: 剑身有裂痕，刻有「青云」符文
├──能力:
│  ├──精神感知: 能感知半径30米内的生命体
│  └──剑气压制: 通过目光释放精神威压
├──状态:
│  ├──身体状态: 右臂有未愈合的刀伤
│  └──心理状态: 对苏明远的实力感到忌惮
├──主要角色间关系网:
│  ├──苏明远: 竞争对手，十年前的同僚
│  └──林婉儿: 暗中培养的继承人
├──触发或加深的事件:
│  ├──兵器库遇袭: 丢失三把传家宝剑，影响战力
│  └──匿名威胁信: 信纸带有檀香味，暗示内部泄密
│

请严格按上述格式分析以下内容：
<<待分析小说文本开始>>
{content}
<<待分析小说文本结束>>
"""
